<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o Papelaria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .completed { text-decoration: line-through; color: green; }
        .pending { color: black; }
        .saldo-positive { color: green; }
        .saldo-negative { color: red; }
        
        /* Ajustes espec√≠ficos para impress√£o */
        @media print {
            /* Garante que o fundo das linhas da tabela apare√ßa na impress√£o */
            .table-striped>tbody>tr:nth-of-type(odd)>* {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            /* Esconde elementos desnecess√°rios na impress√£o (redund√¢ncia ao d-print-none) */
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="text-center mt-4">
        <img src="logo.jpeg" width="150px" class="rounded-circle" alt="Logo" onerror="this.style.display='none'"> 
        <h1 class="mt-2" style="color: rgb(0, 102, 255);">Studio Vieira Papelaria</h1>
    </div>

    <div class="container mt-4">
        <ul class="nav nav-tabs d-print-none" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab">Gest√£o de Servi√ßos</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="movements-tab" data-bs-toggle="tab" data-bs-target="#movements" type="button" role="tab">Controle de Caixa</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            
            <div class="tab-pane fade show active" id="tasks" role="tabpanel">
                
                <div class="card p-3 mt-3 bg-light d-print-none">
                    <h5>Adicionar Nova Tarefa</h5>
                    <form id="taskForm">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label for="cliente" class="form-label">Nome do Cliente</label>
                                <input type="text" class="form-control" id="cliente" required>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="valor" class="form-label">Valor (R$)</label>
                                <input type="number" step="0.01" class="form-control" id="valor" required>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="prazo" class="form-label">Prazo</label>
                                <input type="date" class="form-control" id="prazo" required>
                            </div>
                            <div class="col-12 mb-2">
                                <label for="descricao" class="form-label">Descri√ß√£o</label>
                                <input type="text" class="form-control" id="descricao" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary mt-2">Salvar Tarefa</button>
                    </form>
                </div>

                <h3 class="mt-4 border-bottom pb-2">Relat√≥rio de Servi√ßos</h3>
                <ul id="taskList" class="list-group mt-3"></ul>

                <div class="d-flex justify-content-end gap-2 mt-4 mb-5 d-print-none">
                    <button class="btn btn-outline-secondary" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio de Tarefas</button>
                    <button class="btn btn-outline-danger" onclick="clearAllTasks()">üóëÔ∏è Excluir Todas as Tarefas</button>
                </div>
            </div>

            <div class="tab-pane fade" id="movements" role="tabpanel">
                
                <div class="card p-3 mt-3 bg-light d-print-none">
                    <h5>Adicionar Movimenta√ß√£o</h5>
                    <form id="movementForm">
                        <div class="row">
                            <div class="col-md-5 mb-2">
                                <label for="motivo" class="form-label">Motivo</label>
                                <input type="text" class="form-control" id="motivo" required>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="valorMov" class="form-label">Valor (R$)</label>
                                <input type="number" step="0.01" class="form-control" id="valorMov" required>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="tipo" class="form-label">Tipo</label>
                                <select class="form-select" id="tipo" required>
                                    <option value="entrada">Entrada (+)</option>
                                    <option value="saida">Sa√≠da (-)</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-2">Lan√ßar no Caixa</button>
                    </form>
                </div>

                <h3 class="mt-4 border-bottom pb-2">Fluxo de Caixa</h3>
                <table class="table table-striped mt-3">
                    <thead class="table-dark">
                        <tr>
                            <th>Motivo</th>
                            <th>Valor</th>
                            <th>Data</th>
                            <th>Tipo</th>
                        </tr>
                    </thead>
                    <tbody id="movementTable"></tbody>
                    <tfoot>
                        <tr class="table-secondary">
                            <td colspan="3" class="text-end"><strong>Saldo Total:</strong></td>
                            <td id="saldo" class="fw-bold"></td>
                        </tr>
                    </tfoot>
                </table>

                <div class="d-flex justify-content-end gap-2 mt-4 mb-5 d-print-none">
                    <button class="btn btn-outline-secondary" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio de Caixa</button>
                    <button class="btn btn-outline-danger" onclick="clearAllMovements()">üóëÔ∏è Excluir Todo o Caixa</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // === FUN√á√ïES UTILIT√ÅRIAS (LocalStorage) ===
        function getTasks() { return JSON.parse(localStorage.getItem('tasks') || '[]'); }
        function saveTasks(tasks) { localStorage.setItem('tasks', JSON.stringify(tasks)); }
        
        function getMovements() { return JSON.parse(localStorage.getItem('movements') || '[]'); }
        function saveMovements(movements) { localStorage.setItem('movements', JSON.stringify(movements)); }

        // === L√ìGICA DE TAREFAS ===
        function loadTasks() {
            const tasks = getTasks();
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            if(tasks.length === 0) {
                taskList.innerHTML = '<li class="list-group-item text-center text-muted">Nenhuma tarefa cadastrada.</li>';
                return;
            }

            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                // Adiciona formata√ß√£o para impress√£o
                li.innerHTML = `
                    <div class="${task.concluida ? 'completed' : 'pending'}">
                        <strong>${task.cliente}</strong> <br>
                        <small>${task.descricao} | Entrega: ${formatDate(task.prazo)} | R$ ${task.valor.toFixed(2)}</small>
                    </div>
                    <input type="checkbox" class="form-check-input ms-2 d-print-none" 
                           ${task.concluida ? 'checked' : ''} 
                           onchange="toggleTask(${index}, this.checked)">
                    <span class="d-none d-print-inline fw-bold">${task.concluida ? '(Conclu√≠do)' : '(Pendente)'}</span>
                `;
                taskList.appendChild(li);
            });
        }

        function toggleTask(index, checked) {
            const tasks = getTasks();
            tasks[index].concluida = checked ? 1 : 0;
            saveTasks(tasks);
            loadTasks();
        }

        // Nova Fun√ß√£o: Excluir Todas as Tarefas
        function clearAllTasks() {
            if (confirm("Tem certeza que deseja apagar TODO o hist√≥rico de tarefas? Essa a√ß√£o n√£o pode ser desfeita.")) {
                localStorage.removeItem('tasks');
                loadTasks();
                alert("Tarefas exclu√≠das com sucesso!");
            }
        }

        document.getElementById('taskForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const tasks = getTasks();
            const newTask = {
                id: Date.now(),
                cliente: document.getElementById('cliente').value,
                descricao: document.getElementById('descricao').value,
                valor: parseFloat(document.getElementById('valor').value),
                prazo: document.getElementById('prazo').value,
                concluida: 0
            };
            tasks.push(newTask);
            saveTasks(tasks);
            document.getElementById('taskForm').reset();
            loadTasks();
        });

        // === L√ìGICA DE MOVIMENTA√á√ïES ===
        function loadMovements() {
            const movements = getMovements();
            const movementTable = document.getElementById('movementTable');
            movementTable.innerHTML = '';

            if(movements.length === 0) {
                movementTable.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhuma movimenta√ß√£o registrada.</td></tr>';
                document.getElementById('saldo').textContent = 'R$ 0.00';
                return;
            }

            movements.forEach(mov => {
                const tr = document.createElement('tr');
                const tipoTexto = mov.tipo === 'entrada' ? '<span class="text-success">Entrada</span>' : '<span class="text-danger">Sa√≠da</span>';
                
                tr.innerHTML = `
                    <td>${mov.motivo}</td>
                    <td>R$ ${mov.valor.toFixed(2)}</td>
                    <td>${mov.data_exibicao}</td>
                    <td>${tipoTexto}</td>
                `;
                movementTable.appendChild(tr);
            });

            // Calcular saldo
            const entradas = movements.filter(m => m.tipo === 'entrada').reduce((sum, m) => sum + m.valor, 0);
            const saidas = movements.filter(m => m.tipo === 'saida').reduce((sum, m) => sum + m.valor, 0);
            const saldo = entradas - saidas;
            
            const saldoEl = document.getElementById('saldo');
            saldoEl.textContent = `R$ ${saldo.toFixed(2)}`;
            saldoEl.className = `fw-bold ${saldo >= 0 ? 'saldo-positive' : 'saldo-negative'}`;
        }

        // Nova Fun√ß√£o: Excluir Todas as Movimenta√ß√µes
        function clearAllMovements() {
            if (confirm("Tem certeza que deseja apagar TODO o fluxo de caixa? O saldo ser√° zerado.")) {
                localStorage.removeItem('movements');
                loadMovements();
                alert("Fluxo de caixa limpo com sucesso!");
            }
        }

        document.getElementById('movementForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const movements = getMovements();
            const hoje = new Date();
            
            const newMovement = {
                id: Date.now(),
                motivo: document.getElementById('motivo').value,
                valor: parseFloat(document.getElementById('valorMov').value),
                // Salva formatado para exibi√ß√£o bonita
                data_exibicao: hoje.toLocaleDateString('pt-BR') + ' ' + hoje.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}),
                tipo: document.getElementById('tipo').value
            };
            movements.push(newMovement);
            saveMovements(movements);
            document.getElementById('movementForm').reset();
            loadMovements();
        });

        // Auxiliar para formatar data do input type date (yyyy-mm-dd) para pt-BR
        function formatDate(dateString) {
            if(!dateString) return '';
            const [year, month, day] = dateString.split('-');
            return `${day}/${month}/${year}`;
        }

        // Carregar dados ao iniciar
        loadTasks();
        loadMovements();
    </script>
</body>
</html>